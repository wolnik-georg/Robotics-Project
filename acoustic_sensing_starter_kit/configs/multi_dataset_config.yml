# Standard Pipeline with Multiple Datasets
# This runs the complete analysis pipeline on multiple combined datasets

# Base data directory
base_data_dir: "data"

# Datasets to process (will be combined for training/testing)
datasets:
  # TRAINING: Workspaces 1 & 2 (all surfaces - cutout + pure contact + pure no-contact)
  - "balanced_collected_data_runs_2026_01_15_workspace_2_squares_cutout_undersample"
  - "balanced_collected_data_runs_2026_01_15_workspace_2_pure_no_contact_undersample"
  - "balanced_collected_data_runs_2026_01_15_workspace_2_pure_contact_undersample"

  - "balanced_collected_data_runs_2026_01_15_workspace_1_squares_cutout_undersample"
  - "balanced_collected_data_runs_2026_01_15_workspace_1_pure_no_contact_undersample"
  - "balanced_collected_data_runs_2026_01_15_workspace_1_pure_contact_undersample"
  
# Optional: Specify datasets to use for validation (holdout)
# Leave empty [] to combine all datasets for train/test split
validation_datasets: [
  # VALIDATION: Workspace 3 (cutout surfaces only - Pattern A)
  "balanced_collected_data_runs_2025_12_15_v2_2_workspace3_squares_cutout_undersample",
  # Or use the newer workspace 3 cutout if available:
  # "balanced_collected_data_runs_2025_12_17_v2_workspace_3_squares_cutout_undersample"
]

# Domain Adaptation Configuration
# Test hypothesis: Does adding hold-out data to training improve generalization?
domain_adaptation:
  enabled: false  # Enable to mix hold-out data into training
  holdout_train_split: 0.3  # Fraction of hold-out data to add to training (0.0-1.0)
  # When enabled:
  #   - holdout_train_split (e.g., 0.3) goes to training
  #   - (1 - holdout_train_split) (e.g., 0.7) stays for validation
  # This tests if models memorized surface patterns vs learning general contact detection

# Feature Extraction Mode Configuration
# Choose between hand-crafted features, spectrograms, or both
# Now supports multiple modes for comparison
feature_extraction:
  modes:  # NEW: List of modes to test sequentially
    # - "features"           # Hand-crafted features (65 dimensions)
    - "spectrogram"        # Mel spectrograms (128×256 = 32,768 dimensions)
    # - "mfcc"              # MFCC features (13 × time_frames)
    # - "magnitude_spectrum" # Raw magnitude spectrum
    # - "power_spectrum"     # Power spectrum
    # - "chroma"             # Chroma features (12 bins)
    # - "both"               # Hand-crafted + full spectrograms
  
  # Default mode (for backward compatibility - will be overridden by modes list)
  mode: "spectrogram"  # Options: "features" | "spectrogram" | "mfcc" | "magnitude_spectrum" | "power_spectrum" | "chroma" | "both"
  
  # Spectrogram extraction parameters (used for spectrogram, mfcc, magnitude_spectrum, power_spectrum, chroma, both modes)
  # Optimized for 48kHz audio with contact detection
  spectrogram:
    n_fft: 1024          # REDUCED: FFT window size → freq resolution = 48000/1024 = 46.9 Hz/bin
    hop_length: 512      # REDUCED: Hop between windows → 50% overlap (balance between time/freq resolution)
    n_mels: 64           # Mel bins for spectrograms
    time_bins: 64        # FIXED time bins (instead of dynamic)
    n_mfcc: 13           # MFCC coefficients
    n_chroma: 12         # Chroma bins
    n_mels: 128          # Number of mel frequency bins (doubled for better resolution)
    fmin: 50             # Minimum frequency (Hz) - skip low-freq noise
    fmax: 20000          # Maximum frequency (Hz) - use FULL spectrum up to Nyquist-2kHz
    time_bins: 256       # Number of time bins (doubled for better temporal detail)
    use_log_scale: true  # Use dB scale (recommended for ML)
    
    # MFCC-specific parameters
    n_mfcc: 13           # Number of MFCC coefficients
    
    # Chroma-specific parameters  
    n_chroma: 12         # Number of chroma bins
    
  # Per-sample normalization options
  # NOTE: Testing showed this HURTS performance (-5.8% validation accuracy)
  # The absolute magnitude of features carries discriminative information
  normalization:
    enabled: false       # DISABLED - hurt validation accuracy
    method: "zscore"     # Options: "zscore" (mean=0, std=1), "minmax" (0-1), "robust" (median/IQR), "l2" (unit norm)

# Analysis Experiments
experiments:
  data_processing:
    enabled: true
    apply_audio_smoothing: false
    use_workspace_invariant_features: true  # Enable workspace-invariant features for better generalization
    use_impulse_features: false  # NEW: Enable transfer function / impulse response features
    use_data_augmentation: false  # NEW: Enable data augmentation for training data
    augmentation_factor: 2  # How many augmented copies per original sample
    enhanced_augmentation: false  # DISABLED: Enhanced augmentation hurt performance (-2.9%)
    motion_artifact_removal:
      enabled: false

  dimensionality_reduction:
    enabled: true

  discrimination_analysis:
    enabled: true
    feature_selection:
      enabled: false  # DISABLED: Feature selection hurt performance (-1.0%) - all 80 features needed
      top_k_features: 50  # Number of top features to select (out of 80 total)
      method: "ensemble"  # Method: "ensemble" (RF+GB+XGB average ranks)

  saliency_analysis:
    enabled: false

  feature_ablation:
    enabled: false

  impulse_response:
    enabled: false

  frequency_band_ablation:
    enabled: false

  surface_reconstruction:
    enabled: false

# Output Configuration
output:
  base_dir: "workspace_1_2_train_workspace_3_validate_pattern_A"  # Train: W1&2 all surfaces, Validate: W3 cutout only

# Analysis Experiments (Standard Pipeline)
