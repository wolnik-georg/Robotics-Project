# Standard Pipeline with Multiple Datasets
# This runs the complete analysis pipeline on multiple combined datasets

# Base data directory
base_data_dir: "data"

# Datasets to process (will be combined for training/testing)
datasets:
  # TRAINING: Workspaces 1, 2 & 3 (all surfaces - cutout + pure contact + pure no-contact)
  
  # Workspace 2
  # - "balanced_collected_data_runs_2026_01_15_workspace_2_squares_cutout_undersample"
  - "balanced_collected_data_runs_2026_01_15_workspace_2_squares_cutout_relabeled_undersample"
  # - "balanced_collected_data_runs_2026_01_15_workspace_2_pure_no_contact_undersample"
  # - "balanced_collected_data_runs_2026_01_15_workspace_2_pure_contact_undersample"

  # Workspace 1
  # - "balanced_collected_data_runs_2026_01_15_workspace_1_squares_cutout_undersample"
  - "balanced_collected_data_runs_2026_01_15_workspace_1_squares_cutout_relabeled_undersample"
  # - "balanced_collected_data_runs_2026_01_15_workspace_1_pure_no_contact_undersample"
  # - "balanced_collected_data_runs_2026_01_15_workspace_1_pure_contact_undersample"
  
  # Workspace 3 (now included in training)
  # - "balanced_collected_data_runs_2025_12_15_v2_2_workspace3_squares_cutout_undersample"
  - "balanced_collected_data_runs_2025_12_15_v2_2_workspace3_squares_cutout_relabeled_undersample"
  # - "balanced_collected_data_runs_2026_01_14_workspace_3_pure_contact_undersample"
  # - "balanced_collected_data_runs_2026_01_14_workspace_3_pure_no_contact_undersample"
  # - "balanced_collected_data_runs_2025_12_17_v2_workspace_3_squares_cutout_undersample"
  - "balanced_collected_data_runs_2025_12_17_v2_workspace_3_squares_cutout_relabeled_undersample"
  
# Optional: Specify datasets to use for validation (holdout)
# Leave empty [] to combine all datasets for train/test split
validation_datasets: [
  # VALIDATION: Hold-out dataset (Pattern B - completely separate surface patterns)
  "balanced_collected_data_runs_2026_01_27_hold_out_dataset_relabeled_undersample",
]

# Domain Adaptation Configuration
# Test hypothesis: Does adding hold-out data to training improve generalization?
domain_adaptation:
  enabled: false  # Enable to mix hold-out data into training
  holdout_train_split: 0.3  # Fraction of hold-out data to add to training (0.0-1.0)
  # When enabled:
  #   - holdout_train_split (e.g., 0.3) goes to training
  #   - (1 - holdout_train_split) (e.g., 0.7) stays for validation
  # This tests if models memorized surface patterns vs learning general contact detection

# Feature Extraction Mode Configuration
# Choose between hand-crafted features, spectrograms, or both
# Now supports multiple modes for comparison
feature_extraction:
  modes:  # NEW: List of modes to test sequentially
    # - "features"           # Hand-crafted features (65 dimensions)
    - "spectrogram"        # Mel spectrograms (128×256 = 32,768 dimensions)
    # - "mfcc"              # MFCC features (13 × time_frames)
    # - "magnitude_spectrum" # Raw magnitude spectrum
    # - "power_spectrum"     # Power spectrum
    # - "chroma"             # Chroma features (12 bins)
    # - "both"               # Hand-crafted + full spectrograms
  
  # Default mode (for backward compatibility - will be overridden by modes list)
  mode: "spectrogram"  # Options: "features" | "spectrogram" | "mfcc" | "magnitude_spectrum" | "power_spectrum" | "chroma" | "both"
  
  # Spectrogram extraction parameters (used for spectrogram, mfcc, magnitude_spectrum, power_spectrum, chroma, both modes)
  # Optimized for CONTACT DETECTION: High-freq transients, short duration events
  spectrogram:
    n_fft: 512           # REDUCED: Shorter window for better time resolution (10.6ms @ 48kHz)
                         # Contact events are SHORT - need fine temporal detail
    hop_length: 128      # REDUCED: 75% overlap for smooth transitions (2.7ms hop)
                         # Catches fast transients that longer hops would miss
    n_mels: 80           # INCREASED: More frequency bands to capture contact harmonics
                         # Contact has rich frequency content across spectrum
    time_bins: 128       # INCREASED: More time detail to see impact onset
                         # Result: 80×128 = 10,240 features (2.5× larger BUT better for transients)
    fmin: 100            # INCREASED: Skip very low freq (robot motor noise)
    fmax: 20000          # Keep high freq where contact transients live
    use_log_scale: true  # dB scale emphasizes transients
    
    # MFCC-specific parameters
    n_mfcc: 13           # Number of MFCC coefficients
    
    # Chroma-specific parameters  
    n_chroma: 12         # Number of chroma bins
    
  # Per-sample normalization options
  # NOTE: Testing showed this HURTS performance (-5.8% validation accuracy)
  # The absolute magnitude of features carries discriminative information
  normalization:
    enabled: false       # DISABLED - hurt validation accuracy
    method: "zscore"     # Options: "zscore" (mean=0, std=1), "minmax" (0-1), "robust" (median/IQR), "l2" (unit norm)

# Analysis Experiments
experiments:
  data_processing:
    enabled: true
    apply_audio_smoothing: false
    use_workspace_invariant_features: true  # Enable workspace-invariant features for better generalization
    use_impulse_features: false  # NEW: Enable transfer function / impulse response features
    use_data_augmentation: false  # NEW: Enable data augmentation for training data
    augmentation_factor: 2  # How many augmented copies per original sample
    enhanced_augmentation: false  # DISABLED: Enhanced augmentation hurt performance (-2.9%)
    motion_artifact_removal:
      enabled: false

  dimensionality_reduction:
    enabled: true

  discrimination_analysis:
    enabled: true
    feature_selection:
      enabled: false  # DISABLED: Feature selection hurt performance (-1.0%) - all 80 features needed
      top_k_features: 50  # Number of top features to select (out of 80 total)
      method: "ensemble"  # Method: "ensemble" (RF+GB+XGB average ranks)

  saliency_analysis:
    enabled: false

  feature_ablation:
    enabled: false

  impulse_response:
    enabled: false

  frequency_band_ablation:
    enabled: false

  surface_reconstruction:
    enabled: false

# Output Configuration
output:
  base_dir: "cnn_v4"  # Train: W1&2&3 all surfaces, Validate: Hold-out dataset (Pattern B)

# Analysis Experiments (Standard Pipeline)
